<html>
    <head>
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="sfg.css" type="text/css"/>
        <script type="text/javascript" src="sfg.js"></script>
        <style>
            .col-lg-8{
                position: static;
            }
            /* #canvas {
                width: 100%;
            } */
            
        </style>
        <script type="text/javascript">
            var sfg = null;
            var paths = null;
            var loops = null;
            var srcLabel = "";
            var destLabel = "";

            function init(){
                var canvas = document.getElementById("canvas");
                sfg = new sfgjs.SFG(canvas);
                refreshSymbolsTable();
            }

            function addNode(){
                clearSolution();
                sfg.startAddingNode();
            }

            function addLineEdge(){
                clearSolution();
                sfg.startAddingLineEdge();
                refreshSymbolsTable();
            }

            function addArcEdge(){
                clearSolution();
                sfg.startAddingArcEdge();
                refreshSymbolsTable();
            }

            function deleteItem(){
                if (sfg.isSomethingSelected()){
                    sfg.deleteSelected();
                    refreshSymbolsTable();
                    clearSolution();
                }
            }

            function showForwardPaths(){
                var title = document.getElementById("pathslisttitle");
                title.innerHTML = "Forward Paths";
                showPaths(paths,"Path");
            }

            function showLoops(){
                var title = document.getElementById("pathslisttitle");
                title.innerHTML = "Loops";
                showPaths(loops,"Loop");
            }

            function showPaths(paths,prefix){
                var table = document.getElementById("pathslist");
                //clear table
                while (table.rows.length > 0)
                    table.deleteRow(table.rows.length-1);

                var clickFunction = function(row,path){
                    row.onclick = function(){
                        sfg.markPath(path);
                    }

                    row.title = "Gain : " + path.gain() +
                        "\n" + "Gain value : " + path.gainValue(sfg.symbols);
                }
                if (paths == null)
                    return;

                for (var i=0;i<paths.length;i++){
                    var row = table.insertRow(table.rows.length);
                    if (i%2 == 0)
                        row.className = "even";
                    else
                        row.className = "odd";
                    clickFunction(row,paths[i]);

                    var cell = row.insertCell(0);
                    var textNode = document.createTextNode(prefix + " " + (i+1));
                    cell.appendChild(textNode);
                }
            }

            function clearSolution(){
                srcLabel = "";
                destLabel = "";
                paths = null;
                loops = null;
                showPaths(null);
                document.getElementById("results").innerHTML = "";
            }

            function solve(){
                sfg.startSolve(function(result){
                    var padStr = function (str,length,chr){
                        var pad = (length-str.length)/2;
                        var c = 0;
                        while (c < pad){
                            str = chr + str;
                            c++;
                        }
                        c = 0;
                        while (c < pad){
                            str += chr;
                            c++;
                        }
                        return str;
                    }
                    document.getElementById("results");
                    results.innerHTML = "";
                    var symHTML = "<h3> Symbolic </h3>";
                    var deltaLen = result.sym.delta.length;
                    var numLen = result.sym.num.length;
                    var line = "";
                    if (numLen < deltaLen) {
                        result.sym.num = padStr(result.sym.num,deltaLen," ");
                        line = padStr(line,deltaLen,"_");
                    }else{
                        result.sym.delta = padStr(result.sym.delta,numLen," ");
                        line = padStr(line,numLen,"-");
                    }

                    symHTML += "<pre>" + result.sym.num + "</pre>";
                    symHTML += line;
                    symHTML += "<pre>" +result.sym.delta+ "</pre>";
                    symHTML += "<br/>";
                    symHTML += "<h3> Numeric </h3>";
                    symHTML += result.numeric.num + " / " + result.numeric.delta
                            + " = " + result.numeric.num/result.numeric.delta;
                    results.innerHTML = symHTML;
                    paths = result.paths;
                    loops = result.loops;
                    srcLabel = result.srcLabel;
                    destLabel = result.destLabel;
                    showLoops();
                });
            }

            function refreshSymbolsTable(){
                var symbols = sfg.getSymbols();

                //sort symbols alphabetically
                symbols.sort(function(a,b){
                    if (a.sym < b.sym) return -1;
                    else if (a.sym > b.sym) return 1;
                    return 0;
                });

                var table = document.getElementById("symtable");
                //clear table
                while (table.rows.length > 1)
                    table.deleteRow(table.rows.length-1);

                var clickFunction = function(row,symbol,value){
                    row.onclick = function(){
                        var newValue = prompt("New value for " + symbol + " ?", value);
                        if (newValue){
                            var v = parseFloat(newValue);
                            if (!isNaN(v)){
                                sfg.setSymbolValue(symbol,v);
                                refreshSymbolsTable();
                                clearSolution();
                            }
                            else
                                alert("Not a valid number");
                        }
                    }

                }

                for (var i=0;i<symbols.length;i++){
                    var symbol = symbols[i].sym;
                    var value = symbols[i].value;

                    var row = table.insertRow(table.rows.length);
                    if (i%2 == 0)
                        row.className = "even";
                    else
                        row.className = "odd";
                    clickFunction(row,symbol,value);

                    var cellLeft = row.insertCell(0);
                    var textNode = document.createTextNode(symbol);
                    cellLeft.appendChild(textNode);

                    var cellRight = row.insertCell(1);
                    var textNode = document.createTextNode(value);
                    cellRight.appendChild(textNode);
                }
            }

            function clearAll(){
                if (confirm("Are you sure ?")){
                    sfg.clear();
                    refreshSymbolsTable();
                    clearSolution();
                }
            }

            function editLabel(){
                if (sfg.isSomethingSelected()){
                    var label = prompt("New Label",sfg.getSelectedLabel());
                    if (label){
                        if (isNaN(label)){
                            sfg.setSelectedLabel(label);
                            refreshSymbolsTable();
                            clearSolution();
                        }else{
                            alert("Not a valid label");
                        }
                    }
                }
            }
        </script>
  </head>
  <body onload = "init()">
    <div class="w3-bar w3-black w3-mobile w3-border">
        <a href="." class="w3-bar-item w3-button">Home</a>
        <a href="#" class="w3-bar-item w3-button" id= "zoomIn" onclick="sfg.zoomIn()" >Zoom In (+)</a>
        <a href="#" class="w3-bar-item w3-button"  id= "zoomOut" onclick="sfg.zoomOut()"  >Zoom Out (-)</a>
        <a href="#" class="w3-bar-item w3-button">About</a>
      
      
      </div>
      <div class="w3-sidebar w3-bar-block w3-light-grey" style="width:10%">
      
        <a href="#" class="w3-bar-item w3-button" id= "addNode" onclick="addNode()"> ADD NODE</a>
        <a href="#" class="w3-bar-item w3-button" id= "addLineEdge" onclick="addLineEdge()" >ADD LINE EDGE</a>
        <a href="#" class="w3-bar-item w3-button" id= "addArcEdge" onclick="addArcEdge()">ADD ARC EDGE</a>
        <a href="#" class="w3-bar-item w3-button" id= "deleteItem" onclick="deleteItem()">DELETE SELECTED</a>
        <a href="#" class="w3-bar-item w3-button" id= "clear" onclick="clearAll()">CLEAR</a>
        <a href="#" class="w3-bar-item w3-button" id= "editLabel" onclick="editLabel()">EDIT LABEL</a>
        <a href="#" class="w3-bar-item w3-button"id= "solve" onclick="solve()">SOLVE</a>
        
      </div>

    
    
<div style="margin-left:10%">

    <div class="w3-row">
    
    <div class="w3-twothird">
<canvas id="canvas" width="1000px" height="600px" style="border:solid;" class="w3-margin">
                        sfg canvas
</canvas>
</div>
<div class="w3-third">

<div class="w3-row">


    <div style="width:200px;overflow-y:auto;display:inline-block" title="click on a symbol to change its value">
        <table id="symtable" class="mytable w3-margin ">
            <tr>
                <th> Symbol </th>
                <th> Value </th>
            </tr>
        </table>
    </div>
      

  
            <div style="width:200px;overflow-y:auto">
                <table id="pathslist" class="mytable w3-margin">
                </table>
            
        </div>
      




    
    <a class="w3-button w3-large w3-black w3-hover-light-blue w3-margin" onclick="showForwardPaths()" > Forward Paths</a>
            <a class="w3-button w3-large w3-black w3-hover-light-blue w3-margin" onclick="showLoops()" > Loops </a>
        <div class="w3-card">
          <h3 id="pathslisttitle" title="click on a path or a loop to mark it" class="w3-center w3-animate-zoom"> loops </h3>
          </div>


</div>
 
  </div>
        
  </div>
  

  
    
    


<div style="clear:left" class="w3-margin">
    
    <div id="results" >
    </div>
  </div>
  
  <div id="debug">
  </div>
                  
                  
  </div>

</div>

    
  </body>
</html>
